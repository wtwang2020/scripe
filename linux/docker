
# Use the Miniconda3 image as the base image
FROM continuumio/miniconda3

# Install mamba
RUN conda install mamba -n base -c conda-forge

# Create a new conda environment
RUN mamba create -n myenv

# Set the default command to run bash
CMD ["bash"]

############################################
镜像
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://w27nd407.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
############################################
echo '
FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    wget \
    curl \
    git \
    build-essential \
    && apt-get clean

RUN wget --quiet https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /tmp/miniconda.sh && \
    /bin/bash /tmp/miniconda.sh -b -p /opt/conda && \
    rm /tmp/miniconda.sh

ENV PATH /opt/conda/bin:$PATH

CMD ["bash"]
' > Dockerfile


docker build -t git-conda-tools .
docker run -it -v /home/wtwang2020/dataset:/dataset git-conda-tools

conda init
source ~/.bashrc
docker exec -it agitated_burnell bash
find /dataset -maxdepth 1 -exec ls -lh {} \;

#####docker更新技术
docker run -it -v /home/wtwang2020/dataset:/dataset --name temp_container git-conda-tools
conda install some-package
pip install some-python-package
exit
docker commit temp_container git-conda-tools
docker ps -a  # 列出所有容器，包括已停止的
docker rm temp_container
docker run -it -v /home/wtwang2020/dataset:/dataset --name temp_container git-conda-tools
docker exec -it temp_container bash


###############
ps aux | grep snakemake
nohup snakemake -s work_flow.snakefile --configfile config.yml -j 10 > snakemake.log 2>&1 &

